name: Unit Test
on:
  push:
    branches:
      - main
      - develop
      - feature/shared_ci_test
  pull_request:
    branches:
      - main
      - develop

jobs:
  setup:
    uses: kukai-wallet/ios_shared_ci/.github/workflows/shared_setup.yml@main

  process-setup:
    needs: setup
    runs-on: ${{ fromJSON(needs.setup.outputs.IOS_SHARED_SETUP_RUNS_ON) }}
    steps:

      - name: Test
        run: |
          echo "IOS_SHARED_SETUP_RUNS_ON: ${{ needs.setup.outputs.IOS_SHARED_SETUP_RUNS_ON }}"
          echo "IOS_SHARED_SETUP_RUNS_ON: ${{ needs.setup.outputs.IOS_SHARED_SETUP_XCODE_VERSION }}"
          echo "IOS_SHARED_SETUP_RUNS_ON: ${{ needs.setup.outputs.IOS_SHARED_SETUP_SIMULATOR_VERSION }}"



  # test:
  #   name: Running unit tests
  #   runs-on: macos-15
  #   steps:
  #     - name: Select Xcode version
  #       #run: sudo xcode-select -s '/Applications/Xcode_14.3.1.app/Contents/Developer'
  #       run: sudo xcode-select -s '/Applications/Xcode_26.0.app/Contents/Developer'
        
  #     - name: Checkout repository
  #       uses: actions/checkout@v4.1.1

  #     - name: Get current date
  #       run: echo "NOW=$(date +'%Y-%m-%dT%H-%M-%S')" >> $GITHUB_ENV

  #     - name: Test
  #       #run: xcodebuild test -scheme KukaiCoreSwift -destination "platform=iOS Simulator,OS=16.4,name=iPhone 14" -enableCodeCoverage YES -resultBundlePath "~/xcode-$NOW.xcresult"
  #       run: xcodebuild test -scheme KukaiCoreSwift -destination "platform=iOS Simulator,OS=26.0,name=iPhone 17" -enableCodeCoverage YES -resultBundlePath "~/xcode-$NOW.xcresult"

  #     - name: Upload results
  #       if: ${{ success() || failure() }}
  #       uses: actions/upload-artifact@v4.3.1
  #       with:
  #         name: "results-${{ env.NOW }}.xcresult"
  #         path: "~/xcode-${{ env.NOW }}.xcresult"
      